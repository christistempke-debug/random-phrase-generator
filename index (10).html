<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Random Generator</title>

  <style>
    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: radial-gradient(circle at top, #1f2933, #0b0f14);
      color: #e5e7eb;
    }

    .card {
      background: #111827;
      width: 90%;
      max-width: 420px;
      padding: 30px 26px;
      border-radius: 18px;
      text-align: center;
      box-shadow: 0 20px 50px rgba(0,0,0,0.6);
      border: 1px solid #1f2937;
    }

    h1 {
      margin-bottom: 16px;
      font-size: 1.6rem;
      font-weight: 600;
      color: #f9fafb;
      user-select: none;
    }

    .result {
      font-size: 2rem;
      font-weight: 700;
      margin: 24px 0;
      color: #38bdf8;
      min-height: 46px;
    }

    button {
      width: 100%;
      padding: 14px;
      font-size: 1rem;
      font-weight: 600;
      border: none;
      border-radius: 14px;
      background: linear-gradient(135deg, #38bdf8, #2563eb);
      color: white;
      cursor: pointer;
      margin-top: 12px;
      transition: opacity 0.2s ease;
    }

    button:disabled {
      background: #374151;
      cursor: not-allowed;
    }

    .loading {
      display: none;
      margin-top: 18px;
      font-size: 0.95rem;
      color: #9ca3af;
    }

    .spinner {
      width: 28px;
      height: 28px;
      border: 3px solid #374151;
      border-top-color: #38bdf8;
      border-radius: 50%;
      margin: 12px auto 0;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    input, textarea {
      width: 100%;
      padding: 11px 12px;
      margin-top: 12px;
      border-radius: 12px;
      border: 1px solid #374151;
      background: #020617;
      color: #e5e7eb;
    }

    textarea {
      min-height: 110px;
    }

    .admin {
      display: none;
      margin-top: 24px;
      padding-top: 18px;
      border-top: 1px solid #1f2937;
      text-align: left;
    }

    .danger {
      background: linear-gradient(135deg, #ef4444, #b91c1c);
    }
  </style>
</head>
<body>

  <div class="card">
    <h1 id="title">Random Generator</h1>

    <div class="result" id="result">—</div>

    <button id="generateBtn">Generate</button>

    <div id="loading" class="loading">
      Generating result…
      <div class="spinner"></div>
    </div>

    <div id="login" class="admin">
      <input type="password" id="password" placeholder="Admin password">
      <button onclick="login()">Login</button>
    </div>

    <div id="adminPanel" class="admin">
      <h3>Admin Panel</h3>
      <textarea id="itemsInput" placeholder="Enter items (one per line)"></textarea>
      <button onclick="saveItems()">Save Items</button>
      <button id="resetBtn" class="danger" onclick="resetUsers()" style="display:none;">
        Reset All Users
      </button>
    </div>
  </div>

  <script>
    const ADMIN_PASSWORD = "Pi015z9";
    let isAdmin = false;

    let items = JSON.parse(localStorage.getItem("items")) || ["Book","Pen","Pencil"];
    let history = JSON.parse(localStorage.getItem("history")) || [];

    const btn = document.getElementById("generateBtn");
    const resultEl = document.getElementById("result");
    const loadingEl = document.getElementById("loading");

    if (localStorage.getItem("hasGenerated") === "true") {
      btn.disabled = true;
      btn.textContent = "Already Generated";
      resultEl.textContent = localStorage.getItem("generatedResult") || "—";
    }

    btn.addEventListener("click", generate);

    function getRandomItem() {
      let attempt = 0;
      let result;
      do {
        result = items[Math.floor(Math.random() * items.length)];
        attempt++;
      } while (
        history.length >= 2 &&
        history.at(-1) === result &&
        history.at(-2) === result &&
        attempt < 25
      );
      return result;
    }

    function generate() {
      if (!isAdmin && localStorage.getItem("hasGenerated") === "true") return;

      btn.disabled = true;
      loadingEl.style.display = "block";
      resultEl.textContent = "—";

      setTimeout(() => {
        const result = getRandomItem();
        resultEl.textContent = result;

        history.push(result);
        if (history.length > 3) history.shift();
        localStorage.setItem("history", JSON.stringify(history));

        loadingEl.style.display = "none";

        if (!isAdmin) {
          localStorage.setItem("hasGenerated", "true");
          localStorage.setItem("generatedResult", result);
          btn.textContent = "Already Generated";
        } else {
          btn.disabled = false;
        }
      }, 4000);
    }

    // Admin access
    let pressTimer;
    const title = document.getElementById("title");

    title.addEventListener("mousedown", startPress);
    title.addEventListener("touchstart", startPress);
    title.addEventListener("mouseup", cancelPress);
    title.addEventListener("mouseleave", cancelPress);
    title.addEventListener("touchend", cancelPress);

    function startPress() {
      pressTimer = setTimeout(() => {
        document.getElementById("login").style.display = "block";
      }, 3000);
    }

    function cancelPress() {
      clearTimeout(pressTimer);
    }

    function login() {
      if (document.getElementById("password").value === ADMIN_PASSWORD) {
        isAdmin = true;
        document.getElementById("login").style.display = "none";
        document.getElementById("adminPanel").style.display = "block";
        document.getElementById("resetBtn").style.display = "block";
        document.getElementById("itemsInput").value = items.join("\n");
        btn.disabled = false;
        btn.textContent = "Generate";
      } else {
        alert("Wrong password");
      }
    }

    function saveItems() {
      items = document.getElementById("itemsInput").value
        .split("\n")
        .map(i => i.trim())
        .filter(Boolean);
      localStorage.setItem("items", JSON.stringify(items));
      alert("Saved");
    }

    function resetUsers() {
      if (!isAdmin) return;
      if (!confirm("Reset all users?")) return;

      localStorage.removeItem("hasGenerated");
      localStorage.removeItem("generatedResult");
      localStorage.removeItem("history");
      history = [];
      btn.disabled = false;
      btn.textContent = "Generate";
      resultEl.textContent = "—";
      alert("All users reset");
    }
  </script>

</body>
</html>
